name: Deploy
on:
    push:
        branches: [main]
        tags:
            - 'v*.*.*'
jobs:
    build:
         runs-on: ubuntu-latest

         steps:
        
         - uses: actions/checkout@v2

         - name: Docker metadata
           id: docker_meta
           uses: crazy-max/ghaction-docker-meta@v1
           with:
              images: unitynts/appwork_web
              tag-sha: true

        


         - name: QEMU
           uses: docker/setup-qemu-action@/v1


         - name: Docker Buildx
           uses: docker/setup-buidx-action@v1

         - name: Login to Dockerhub
           uses: docker/login-action@v1
           with:
             username: ${{secrets.DOCKERHUB_USERNAME}}
             password: ${{secrets.DOCKERHUB_TOKEN}}
         
         - name: Build and Push
           id: docker_build
           uses: docker/build-push-actions@v2
           with:
             context: ./image-appwork/docker/appwork
             file: ./image-appwork/docker/appwork/Dockerfile
             platforms: linux/amd64
             tags: ${{steps.docker_meta.outputs.tags}}
             labels: ${{steps.docker_meta.outputs.tags}}


 